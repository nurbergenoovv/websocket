<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Echo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function() {
            var socket = null;
            var userName = ''; // Define userName variable globally

            function connectWithUserName() {
                userName = document.getElementById('name_input').value.trim();
                if (userName === '') {
                    alert('Please enter your name.');
                    return;
                }

                socket = io('https://myapi.kz', {
                    query: { name: userName }
                });

                socket.on('connect', function() {
                    socket.send('User ' + userName + ' has connected!');
                });

                socket.on('message', function(data) {
                    console.log(data)
                    displayMessage(userName, data);
                });

                document.getElementById('name_prompt').style.display = 'none';
                document.getElementById('chat_interface').style.display = 'block';
            }

            function displayMessage(sender, message) {
                var container = document.createElement('div');
                var usernameElement = document.createElement('h2');
                var messageElement = document.createElement('p');

                usernameElement.textContent = sender;
                messageElement.textContent = message;

                container.appendChild(usernameElement);
                container.appendChild(messageElement);

                var messagesContainer = document.getElementById('messages');
                messagesContainer.insertBefore(container, messagesContainer.firstChild);
            }

            document.getElementById('connect_button').addEventListener('click', connectWithUserName);

            document.getElementById('send_button').addEventListener('click', function() {
                var messageInput = document.getElementById('message_input');
                var message = messageInput.value.trim();

                if (message !== '') {
                    socket.send(message);
                    messageInput.value = ''; // Clear input field after sending message
                }
            });
        });
    </script>
</head>
<body>
    <!-- Name Input Section -->
    <div id="name_prompt">
        <h1>Enter Your Name</h1>
        <input id="name_input" type="text">
        <button id="connect_button">Connect</button>
    </div>

    <!-- Chat Interface (Hidden initially) -->
    <div id="chat_interface" style="display: none;">
        <h1>WebSocket Echo</h1>
        <input id="message_input" type="text">
        <button id="send_button">Send</button>
        <div id="messages" style="display: flex; flex-direction: column-reverse;"></div>
    </div>
</body>
</html>
